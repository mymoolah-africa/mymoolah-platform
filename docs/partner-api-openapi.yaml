openapi: 3.0.3
info:
  title: MyMoolah Partner API
  version: 1.0.0
  description: |
    Banking-grade RESTful API for partners to integrate with MyMoolah to sell MMVouchers.
    Follows Mojaloop 1.0 and ISO 20022 standards.
  contact:
    name: MyMoolah API Support
    email: api-support@mymoolah.com
    url: https://docs.mymoolah.com/api
  license:
    name: Proprietary
    url: https://mymoolah.com/terms

servers:
  - url: https://uat-api.mymoolah.com/api/v1/partner
    description: UAT Environment
  - url: https://api.mymoolah.com/api/v1/partner
    description: Production Environment

tags:
  - name: Authentication
    description: Partner authentication and token management
  - name: Vouchers
    description: Voucher issuance and query operations
  - name: Webhooks
    description: Webhook event notifications

paths:
  /auth/token:
    post:
      tags: [Authentication]
      summary: Get access token
      description: Exchange partner credentials for JWT access token using OAuth 2.0 Client Credentials flow
      operationId: getAccessToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenRequest'
            examples:
              default:
                value:
                  grant_type: client_credentials
                  client_id: partner_zapper_001
                  client_secret: your_api_secret_here
      responses:
        '200':
          description: Token issued successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /vouchers/issue:
    post:
      tags: [Vouchers]
      summary: Issue MMVoucher
      description: Create a new MyMoolah voucher for a customer
      operationId: issueVoucher
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoucherIssueRequest'
            examples:
              standard:
                value:
                  amount: 100.00
                  currency: ZAR
                  customer:
                    msisdn: "27825571055"
                    name: John Doe
                    email: john.doe@example.com
                  metadata:
                    partner_reference: ZAPPER-ORDER-12345
                    description: Voucher purchase via Zapper
                    merchant_id: ZAPPER-MERCHANT-001
                  expiry_days: 365
      responses:
        '201':
          description: Voucher issued successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoucherIssueResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '402':
          description: Insufficient balance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      headers:
        X-RateLimit-Limit:
          schema:
            type: integer
          description: Rate limit per window
        X-RateLimit-Remaining:
          schema:
            type: integer
          description: Remaining requests in window
        X-RateLimit-Reset:
          schema:
            type: integer
          description: Unix timestamp when limit resets

  /vouchers/{voucher_code}:
    get:
      tags: [Vouchers]
      summary: Query voucher by code
      description: Get voucher details and status by voucher code
      operationId: getVoucherByCode
      security:
        - bearerAuth: []
      parameters:
        - name: voucher_code
          in: path
          required: true
          description: 16-digit voucher code
          schema:
            type: string
            pattern: '^\d{16}$'
            example: "1234567890123456"
      responses:
        '200':
          description: Voucher found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoucherQueryResponse'
        '404':
          description: Voucher not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /vouchers/partner/{partner_reference}:
    get:
      tags: [Vouchers]
      summary: Query voucher by partner reference
      description: Get voucher details using your partner reference ID
      operationId: getVoucherByPartnerReference
      security:
        - bearerAuth: []
      parameters:
        - name: partner_reference
          in: path
          required: true
          description: Your unique partner reference ID
          schema:
            type: string
            example: "ZAPPER-ORDER-12345"
      responses:
        '200':
          description: Voucher found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoucherQueryResponse'
        '404':
          description: Voucher not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token from /auth/token endpoint

  schemas:
    TokenRequest:
      type: object
      required:
        - grant_type
        - client_id
        - client_secret
      properties:
        grant_type:
          type: string
          enum: [client_credentials]
          example: client_credentials
        client_id:
          type: string
          description: Partner ID
          example: partner_zapper_001
        client_secret:
          type: string
          format: password
          description: Partner API secret
          example: your_api_secret_here

    TokenResponse:
      type: object
      properties:
        access_token:
          type: string
          description: JWT access token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        token_type:
          type: string
          enum: [Bearer]
          example: Bearer
        expires_in:
          type: integer
          description: Token expiry in seconds
          example: 3600
        scope:
          type: string
          description: Token scope
          example: voucher:issue voucher:query

    VoucherIssueRequest:
      type: object
      required:
        - amount
        - currency
        - customer
        - metadata
      properties:
        amount:
          type: number
          format: decimal
          minimum: 5.00
          maximum: 4000.00
          description: Voucher amount in ZAR
          example: 100.00
        currency:
          type: string
          enum: [ZAR]
          description: Currency code (must be ZAR)
          example: ZAR
        customer:
          type: object
          required:
            - msisdn
          properties:
            msisdn:
              type: string
              pattern: '^27\d{9}$'
              description: Customer mobile number in E.164 format (without +)
              example: "27825571055"
            name:
              type: string
              description: Customer full name
              example: John Doe
            email:
              type: string
              format: email
              description: Customer email address
              example: john.doe@example.com
        metadata:
          type: object
          required:
            - partner_reference
          properties:
            partner_reference:
              type: string
              description: Your unique order/reference ID
              example: ZAPPER-ORDER-12345
            description:
              type: string
              description: Transaction description
              example: Voucher purchase via Zapper
            merchant_id:
              type: string
              description: Your merchant/store identifier
              example: ZAPPER-MERCHANT-001
        expiry_days:
          type: integer
          minimum: 1
          maximum: 730
          default: 365
          description: Voucher expiry in days
          example: 365

    VoucherIssueResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Voucher issued successfully
        data:
          type: object
          properties:
            voucher_code:
              type: string
              pattern: '^\d{16}$'
              description: 16-digit voucher code
              example: "1234567890123456"
            voucher_id:
              type: string
              description: Internal voucher ID
              example: VOUCHER-12345
            amount:
              type: number
              format: decimal
              example: 100.00
            currency:
              type: string
              example: ZAR
            status:
              type: string
              enum: [active, pending_payment, expired, cancelled, redeemed]
              example: active
            expires_at:
              type: string
              format: date-time
              description: ISO 8601 timestamp
              example: "2026-11-12T18:00:00.000Z"
            created_at:
              type: string
              format: date-time
              example: "2025-11-12T18:00:00.000Z"
            transaction_id:
              type: string
              example: TXN-1762974300000-abc123
            partner_reference:
              type: string
              example: ZAPPER-ORDER-12345
        timestamp:
          type: string
          format: date-time
          example: "2025-11-12T18:00:00.000Z"

    VoucherQueryResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            voucher_code:
              type: string
              example: "1234567890123456"
            voucher_id:
              type: string
              example: VOUCHER-12345
            amount:
              type: number
              format: decimal
              example: 100.00
            balance:
              type: number
              format: decimal
              description: Remaining voucher balance
              example: 75.50
            currency:
              type: string
              example: ZAR
            status:
              type: string
              enum: [active, pending_payment, expired, cancelled, redeemed]
              example: active
            expires_at:
              type: string
              format: date-time
              example: "2026-11-12T18:00:00.000Z"
            created_at:
              type: string
              format: date-time
              example: "2025-11-12T18:00:00.000Z"
            redemption_count:
              type: integer
              example: 1
            customer:
              type: object
              properties:
                msisdn:
                  type: string
                  example: "27825571055"
                name:
                  type: string
                  example: John Doe
        timestamp:
          type: string
          format: date-time
          example: "2025-11-12T18:00:00.000Z"

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: Error type
          example: VALIDATION_ERROR
        error_code:
          type: string
          description: Specific error code
          example: INVALID_AMOUNT
        message:
          type: string
          description: Human-readable error message
          example: Voucher value must be between 5.00 and 4000.00
        details:
          type: object
          description: Additional error details
          additionalProperties: true
        timestamp:
          type: string
          format: date-time
          example: "2025-11-12T18:00:00.000Z"
        request_id:
          type: string
          format: uuid
          description: Request ID for tracking
          example: 550e8400-e29b-41d4-a716-446655440000


