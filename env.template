# MyMoolah Treasury Platform - Environment Configuration Template
# Copy this file to .env and configure your environment variables

# =============================================================================
# CORE APPLICATION CONFIGURATION
# =============================================================================

# Application Environment
NODE_ENV=development
PORT=3001

# =============================================================================
# TLS 1.3 CONFIGURATION (BANKING-GRADE SECURITY)
# =============================================================================

# TLS Configuration
TLS_ENABLED=true
SSL_CERT_PATH=./certs/certificate.pem
SSL_KEY_PATH=./certs/private-key.pem

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# PostgreSQL Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=mymoolah_dev
DB_USER=mymoolah_user
DB_PASSWORD=secure_password

# Database SSL (Production Only)
DB_SSL_CA=
DB_SSL_CERT=
DB_SSL_KEY=

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# JWT Configuration
JWT_SECRET=your_super_secure_jwt_secret_key_at_least_32_characters_long
JWT_EXPIRES_IN=24h

# Session Configuration
SESSION_SECRET=your_session_secret_key_at_least_32_characters_long

# =============================================================================
# EXTERNAL SERVICE INTEGRATIONS
# =============================================================================

# Flash Integration
FLASH_CONSUMER_KEY=your_flash_consumer_key
FLASH_CONSUMER_SECRET=your_flash_consumer_secret
FLASH_ACCOUNT_NUMBER=your_flash_account_number
FLASH_API_URL=https://api.flashswitch.flash-group.com
FLASH_LIVE_INTEGRATION=false

# MobileMart Integration (Fulcrum API)
# UAT Environment: https://uat.fulcrumswitch.com
# PROD Environment: https://fulcrumswitch.com
# NOTE: PROD credentials verified working by MobileMart (2025-11-10)
# UAT credentials: Request via WhatsApp (provide cellphone number)
MOBILEMART_LIVE_INTEGRATION=false
# PROD Credentials (verified working)
MOBILEMART_CLIENT_ID=mymoolah
MOBILEMART_CLIENT_SECRET=c799bf37-934d-4dcf-bfec-42fb421a6407
# UAT Credentials (to be provided via WhatsApp)
# MOBILEMART_CLIENT_ID=mymoolah
# MOBILEMART_CLIENT_SECRET=<UAT_SECRET_FROM_WHATSAPP>
MOBILEMART_API_URL=https://uat.fulcrumswitch.com
MOBILEMART_TOKEN_URL=https://uat.fulcrumswitch.com/connect/token
MOBILEMART_SCOPE=api
# Legacy variables (deprecated, kept for backward compatibility)
MOBILEMART_API_KEY=your_mobilemart_api_key
MOBILEMART_API_ENDPOINT=https://api.mobilemart.co.za

# dtMercury Integration
DTMERCURY_API_KEY=your_dtmercury_api_key
DTMERCURY_API_ENDPOINT=https://api.dtmercury.co.za

# =============================================================================
# EASYPAY TOP-UP CONFIGURATION
# =============================================================================
# EasyPay Top-up fees in cents (VAT Inclusive)
EASYPAY_TOPUP_PROVIDER_FEE=200    # Provider fee in cents (R2.00)
EASYPAY_TOPUP_MM_MARGIN=50        # MyMoolah margin in cents (R0.50)

# =============================================================================
# EASYPAY CASH-OUT CONFIGURATION
# =============================================================================
# EasyPay Cash-out fees in cents (VAT Inclusive)
EASYPAY_CASHOUT_USER_FEE=800      # User transaction fee in cents (R8.00)
EASYPAY_CASHOUT_PROVIDER_FEE=500 # EasyPay provider fee in cents (R5.00)
EASYPAY_CASHOUT_MM_MARGIN=300     # MyMoolah revenue margin in cents (R3.00)
EASYPAY_CASHOUT_VAT_RATE=0.15     # VAT rate (15%)

# EasyPay Standalone Voucher Configuration
EASYPAY_VOUCHER_TRANSACTION_FEE=2.50  # Transaction fee for EasyPay vouchers (R2.50)
EASYPAY_VOUCHER_MIN_AMOUNT=50         # Minimum voucher amount (R50)
EASYPAY_VOUCHER_MAX_AMOUNT=3000       # Maximum voucher amount (R3000)
EASYPAY_VOUCHER_EXPIRY_HOURS=96       # Expiry time in hours (4 days)

# EasyPay Float Account IDs
EASYPAY_TOPUP_FLOAT_ID=easypay_topup
EASYPAY_CASHOUT_FLOAT_ID=easypay_cashout

# EasyPay API Authentication
# API key for EasyPay settlement endpoints (X-API-Key header)
# Generate a secure random string (min 32 characters)
# Example: openssl rand -hex 32
EASYPAY_API_KEY=your_easypay_api_key_here_change_in_production

# EasyPay API Base URLs
# Staging/UAT: https://staging.mymoolah.africa/api/v1
# Production: https://api.mymoolah.africa/api/v1 (when available)
# Local: http://localhost:3001/api/v1
EASYPAY_API_BASE_URL=https://staging.mymoolah.africa/api/v1

# Peach Payments Integration
# Sandbox URLs
PEACH_BASE_AUTH=https://sandbox-dashboard.peachpayments.com
PEACH_BASE_CHECKOUT=https://testsecure.peachpayments.com
# Production URLs (confirmed by Peach Payments Support)
# PEACH_BASE_AUTH=https://dashboard.peachpayments.com
# PEACH_BASE_CHECKOUT=https://secure.peachpayments.com
PEACH_CLIENT_ID=your_peach_client_id
PEACH_CLIENT_SECRET=your_peach_client_secret
PEACH_MERCHANT_ID=your_peach_merchant_id
PEACH_ENTITY_ID_PSH=your_peach_payshap_entity_id
PEACH_ENABLE_TEST_MODE=true
# Webhook secret token (from Peach dashboard - Checkout tab)
PEACH_WEBHOOK_SECRET=your_peach_webhook_secret_token
# Legacy variables (deprecated)
PEACH_API_KEY=your_peach_api_key
PEACH_API_ENDPOINT=https://api.peachpayments.com

# Zapper Integration (QR Code Payments)
# Test Credentials (from Postman collection - tested with 2 test QR codes)
# NOTE: These are TEST credentials. Production credentials will be provided separately.
ZAPPER_API_URL=https://api.zapper.com/v1
ZAPPER_ORG_ID=810c1540-6de0-11f0-9286-4f0cdcb898f5
ZAPPER_API_TOKEN=eb22884a-bc62-4307-ac21-ac9f2ac140f2
ZAPPER_X_API_KEY=8h8DDBvlaPoYgefHwqeG3DNZaO6vorxWPsCDtvd0

# =============================================================================
# CORS CONFIGURATION
# =============================================================================

# Allowed Origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# Redis Cache
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log Level
LOG_LEVEL=debug

# =============================================================================
# FEATURE TOGGLES
# =============================================================================

# Service Enablers
CATALOG_SYNC_ENABLED=true
RECURRING_REQUESTS_ENABLED=true
EASYPAY_EXPIRY_HANDLER_ENABLED=true

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Performance Monitoring
ENABLE_PERFORMANCE_MONITORING=true
ENABLE_DATABASE_MONITORING=true

# =============================================================================
# LEDGER / ACCOUNTING CONFIGURATION
# =============================================================================

# VAT rate applied to commission (inclusive)
VAT_RATE=0.15

# Ledger account codes for VAS commission allocation
LEDGER_ACCOUNT_MM_COMMISSION_CLEARING=2200-01-01
LEDGER_ACCOUNT_COMMISSION_REVENUE=4000-10-01
LEDGER_ACCOUNT_VAT_CONTROL=2300-10-01

# Extended closed-loop accounts (client/supplier float & clearing, interchange, bank)
# Populate these in UAT/Prod via env/secrets; values below are recommended defaults.
LEDGER_ACCOUNT_CLIENT_FLOAT=2100-01-01
LEDGER_ACCOUNT_CLIENT_CLEARING=2100-02-01
LEDGER_ACCOUNT_SUPPLIER_CLEARING=2200-02-01
LEDGER_ACCOUNT_INTERCHANGE=1200-05-01
LEDGER_ACCOUNT_BANK=1100-01-01

# Optional: separate transaction fee revenue (e.g., QR/payments fees)
LEDGER_ACCOUNT_TRANSACTION_FEE_REVENUE=4000-20-01

# =============================================================================
# SUPPLIER FLOAT LEDGER ACCOUNTS
# =============================================================================
# Supplier Float Accounts (Asset accounts - prefunded balances payable to suppliers)
# These are ledger account codes that must exist in the ledger_accounts table
# Format: 1200-10-XX (Asset - Float Accounts)
LEDGER_ACCOUNT_ZAPPER_FLOAT=1200-10-01
LEDGER_ACCOUNT_EASYPAY_TOPUP_FLOAT=1200-10-02
LEDGER_ACCOUNT_EASYPAY_CASHOUT_FLOAT=1200-10-03
LEDGER_ACCOUNT_FLASH_FLOAT=1200-10-04
LEDGER_ACCOUNT_MOBILEMART_FLOAT=1200-10-05
LEDGER_ACCOUNT_DTMERCURY_FLOAT=1200-10-06

# =============================================================================
# OPERATIONAL FLOAT ACCOUNT IDENTIFIERS
# =============================================================================
# These are operational identifiers (NOT ledger account codes)
# Used for internal tracking and reference only
ZAPPER_FLOAT_ACCOUNT_NUMBER=ZAPPER_FLOAT_001

# =============================================================================
# FLOAT BALANCE MONITORING SERVICE
# =============================================================================
# Scheduled service that monitors supplier float account balances and sends
# email notifications to suppliers when balances fall below thresholds
FLOAT_BALANCE_CHECK_INTERVAL_MINUTES=60          # Check interval in minutes (default: 60 = hourly)
FLOAT_BALANCE_CHECK_SCHEDULE=                    # Optional: Custom cron schedule (e.g., "0 */2 * * *" for every 2 hours)
                                                  # If not set, uses FLOAT_BALANCE_CHECK_INTERVAL_MINUTES
FLOAT_BALANCE_WARNING_THRESHOLD=0.15             # Warning when balance is within 15% of minimum (0.15 = 15%)
FLOAT_BALANCE_CRITICAL_THRESHOLD=0.05            # Critical when balance is within 5% of minimum (0.05 = 5%)
FLOAT_BALANCE_NOTIFICATION_COOLDOWN_HOURS=24     # Hours between notifications for same supplier/level (prevents spam)
FLOAT_ALERT_CC_EMAIL=finance@mymoolah.africa     # Optional: CC email for all float balance alerts

# =============================================================================
# EMAIL CONFIGURATION (for Float Balance Alerts)
# =============================================================================
# SMTP configuration for sending email notifications to suppliers
# Required for Float Balance Monitoring Service email alerts
SMTP_HOST=smtp.gmail.com                         # SMTP server hostname
SMTP_PORT=587                                     # SMTP server port (587 for TLS, 465 for SSL)
SMTP_USER=                                        # SMTP username (email address)
SMTP_PASS=                                        # SMTP password (app password for Gmail)

# =============================================================================
# PRODUCTION SETTINGS
# =============================================================================

# For production, ensure these settings:
# NODE_ENV=production
# TLS_ENABLED=true
# JWT_SECRET=very_long_secure_random_string_at_least_64_characters
# SESSION_SECRET=very_long_secure_random_string_at_least_64_characters
# LOG_LEVEL=warn
# CORS_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# =============================================================================
# SECURITY NOTES
# =============================================================================

# IMPORTANT SECURITY REQUIREMENTS:
# 1. JWT_SECRET must be at least 32 characters long
# 2. SESSION_SECRET must be at least 32 characters long
# 3. TLS_ENABLED=true for production environments
# 4. Use strong, unique passwords for all services
# 5. Keep API keys secure and rotate regularly
# 6. Use HTTPS in production with valid SSL certificates
# 7. Configure proper CORS origins for production
# 8. Enable all security headers and rate limiting
# 9. Use environment-specific configurations
# 10. Never commit .env files to version control

# =============================================================================
# MOJALOOP COMPLIANCE NOTES
# =============================================================================

# TLS 1.3 Configuration for Mojaloop FSPIOP Compliance:
# - TLS_ENABLED=true (required)
# - Strong cipher suites configured automatically
# - Perfect Forward Secrecy enabled
# - OCSP Stapling enabled
# - Certificate transparency enabled
# - Security headers configured for banking-grade compliance
# - Rate limiting configured for financial transactions
# - Input validation and sanitization enabled
# - Audit logging enabled
# - Error handling with security considerations

# =============================================================================
# BANKING-GRADE SECURITY FEATURES
# =============================================================================

# ========================================
# WATCH TO EARN CONFIGURATION
# ========================================
# Ad platform configuration for video advertising feature
WATCH_TO_EARN_ENABLED=true
AD_MIN_WATCH_PERCENTAGE=95          # Must watch 95%+ to earn
AD_MAX_VIEWS_PER_HOUR=5             # Fraud prevention: max 5 ads per hour per user
AD_MAX_VIEWS_PER_DAY=20             # Fraud prevention: max 20 ads per day per user
AD_REWARD_REACH=2.00                # R2.00 reward for Reach ads (view only)
AD_REWARD_ENGAGEMENT=3.00           # R3.00 total reward for Engagement ads (R2.00 view + R1.00 bonus)
AD_COST_REACH=6.00                  # Merchant pays R6.00 for Reach ads
AD_COST_ENGAGEMENT=15.00            # Merchant pays R15.00 for Engagement ads
PAYOUT_TO_AD_FLOAT_RATIO=200       # R200 payout = R6.00 ad float credit (1 free ad view)

# Video Infrastructure
GCS_AD_VIDEOS_BUCKET=mymoolah-ads   # GCS bucket for ad videos

# Content Moderation
AD_MODERATION_MODE=manual           # manual | ai | hybrid (use manual for launch)

# Ledger Accounts (for double-entry accounting)
LEDGER_ACCOUNT_MERCHANT_AD_FLOAT=2100-05-01    # Merchant ad float (liability)
LEDGER_ACCOUNT_AD_REVENUE=4100-05-01           # Ad platform revenue (income)
LEDGER_ACCOUNT_AD_REWARD_EXPENSE=5100-03-01    # User rewards paid (expense)

# Automatic Security Features:
# - TLS 1.3 enforcement
# - AES-256-GCM encryption
# - ChaCha20-Poly1305 cipher support
# - Perfect Forward Secrecy
# - Certificate pinning (production)
# - Security headers (HSTS, CSP, X-Frame-Options, etc.)
# - Rate limiting for financial transactions
# - Input validation and sanitization
# - SQL injection protection
# - XSS protection
# - CSRF protection
# - Audit logging
# - Error handling without information disclosure
# - Session management with secure cookies
# - JWT with HS512 algorithm
# - CORS with strict origin validation 